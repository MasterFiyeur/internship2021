<?php 
/*from :
array(6) { ["rw"]=> string(7) "laisser" [0]=> string(7) "laisser" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(608) [2]=> int(608) }
array(6) { ["rw"]=> string(6) "perdre" [0]=> string(6) "perdre" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(94) [2]=> int(94) }
array(6) { ["rw"]=> string(7) "lâcher" [0]=> string(7) "lâcher" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(86) [2]=> int(86) }
array(6) { ["rw"]=> string(6) "enfant" [0]=> string(6) "enfant" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(78) [2]=> int(78) }
array(6) { ["rw"]=> string(6) "échec" [0]=> string(6) "échec" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(74) [2]=> int(74) }
array(6) { ["rw"]=> string(6) "lâche" [0]=> string(6) "lâche" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(70) [2]=> int(70) }
array(6) { ["rw"]=> string(10) "délaisser" [0]=> string(10) "délaisser" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(68) [2]=> int(68) }
array(6) { ["rw"]=> string(14) "laisser tomber" [0]=> string(14) "laisser tomber" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(64) [2]=> int(64) }
array(6) { ["rw"]=> string(5) "chien" [0]=> string(5) "chien" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(58) [2]=> int(58) }
array(6) { ["rw"]=> string(8) "arrêter" [0]=> string(8) "arrêter" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(40) [2]=> int(40) }
array(6) { ["rw"]=> string(8) "orphelin" [0]=> string(8) "orphelin" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(34) [2]=> int(34) }
array(6) { ["rw"]=> string(8) "renoncer" [0]=> string(8) "renoncer" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(30) [2]=> int(30) }
array(6) { ["rw"]=> string(7) "quitter" [0]=> string(7) "quitter" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(28) [2]=> int(28) }
array(6) { ["rw"]=> string(7) "animaux" [0]=> string(7) "animaux" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(26) [2]=> int(26) }
array(6) { ["rw"]=> string(9) "lâcheté" [0]=> string(9) "lâcheté" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(24) [2]=> int(24) }
array(6) { ["rw"]=> string(4) "seul" [0]=> string(4) "seul" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(22) [2]=> int(22) }
array(6) { ["rw"]=> string(8) "échouer" [0]=> string(8) "échouer" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(20) [2]=> int(20) }
array(6) { ["rw"]=> string(6) "partir" [0]=> string(6) "partir" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(20) [2]=> int(20) }
array(6) { ["rw"]=> string(6) "animal" [0]=> string(6) "animal" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(18) [2]=> int(18) }
array(6) { ["rw"]=> string(16) "baisser les bras" [0]=> string(16) "baisser les bras" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(18) [2]=> int(18) }
array(6) { ["rw"]=> string(6) "jamais" [0]=> string(6) "jamais" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(16) [2]=> int(16) }
array(6) { ["rw"]=> string(9) "continuer" [0]=> string(9) "continuer" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(14) [2]=> int(14) }
array(6) { ["rw"]=> string(8) "défaite" [0]=> string(8) "défaite" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(14) [2]=> int(14) }
array(6) { ["rw"]=> string(12) "persévérer" [0]=> string(12) "persévérer" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(14) [2]=> int(14) }
array(6) { ["rw"]=> string(6) "faible" [0]=> string(6) "faible" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(12) [2]=> int(12) }
array(6) { ["rw"]=> string(7) "oublier" [0]=> string(7) "oublier" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(12) [2]=> int(12) }
array(6) { ["rw"]=> string(8) "solitude" [0]=> string(8) "solitude" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(12) [2]=> int(12) }
array(6) { ["rw"]=> string(1) "-" [0]=> string(1) "-" ["word"]=> string(10) "abandonner" [1]=> string(10) "abandonner" ["cnt"]=> int(10) [2]=> int(10) } 

function : test=12&chr=A&sort=0*/

function db_right_dict($test, $base, $chr, $sort_order, $json){
	global $db_host, $db_user, $db_pass, $db_enc, $db_name, $db_port;
	$res = Array();
	$conn = connect($db_host, $db_port, $db_name, $db_user, $db_pass, $db_enc);
	if($conn){
		$search = searchRequest($json);
				if(strlen($chr)>0) {
					$rest = substr(strtolower($chr), 1);
//					if(strtolower($chr[0]) == 'e'){
//						$search .= "AND  lower(dict.word) SIMILAR  TO '(e|é|è|ê)%'  ";
//					}else{
//						$search .= "AND lower(dict.word) like '".strtolower($chr[0])."%' ";
//				   }
					if(strtolower($chr[0]) == 'e'){
						$search .= "AND  lower(dict.word) SIMILAR  TO '((un|une|le|la|les) )*(e|é|è|ê){$rest}%' ";
					}else 
					if(strtolower($chr[0]) == 'a'){
						$search .= "AND  lower(dict.word) SIMILAR  TO '((un|une|le|la|les) )*(a|à|â){$rest}%' ";
					}else
					if(strtolower($chr[0]) == 'o'){
						$search .= "AND  lower(dict.word) SIMILAR  TO '((un|une|le|la|les) )*(o|ô){$rest}%' ";
					}else
					if(strtolower($chr[0]) == 'c'){
						$search .= "AND  lower(dict.word) SIMILAR  TO '((un|une|le|la|les) )*(c|ç){$rest}%' ";
					}else
					if(strtolower($chr[0]) == 'i'){
						$search .= "AND  lower(dict.word)  SIMILAR  TO '((un|une|le|la|les) )*(i|î){$rest}%' ";
					}else
					if(strtolower($chr[0]) == 'u'){
						$search .= "AND  (lower(dict.word) SIMILAR TO '((un|une|le|la|les) )*(u|û){$rest}%'  and ".
										"lower(dict.word) not similar to '(un|une) (1|2|3|4|5|6|7|8|9|0|a|à|â|b|c|ç|d|e|é|è|ê|f|g|h|i|î|j|k|l|m|n|o|ô|p|q|r|s|t|v|w|x|y|z)%') ";
					}else
					if(strtolower($chr[0]) == 'l'){
						$search .= "AND  (lower(dict.word) similar to '((un|une|le|la|les) )*l{$rest}%' and ".
										"lower(dict.word) not similar to '(la|le|les) (1|2|3|4|5|6|7|8|9|0|a|à|â|b|c|ç|d|e|é|è|ê|f|g|h|i|î|j|k|m|n|o|ô|p|q|r|s|t|u|û|v|w|x|y|z)%') ";
					}else
					if(strtolower($chr[0]) == '?'){
						$search .= "AND  lower(dict.word)  NOT SIMILAR  TO ".
							"'(1|2|3|4|5|6|7|8|9|0|a|à|â|b|c|ç|d|e|é|è|ê|f|g|h|i|î|j|k|l|m|n|o|ô|p|q|r|s|t|u|û|v|w|x|y|z)%' ";
					}else { 

						$search .= "AND lower(dict.word) similar to '((un|une|le|la|les) )*".strtolower($chr)."%' ";
					}
 
				}
		// commented  base dict
		//if($base == 1) $search.= "AND dict.base='T' ";		
		$result = pg_exec ($conn, "select resp.word as rw, dict.word, count(resp.word) as cnt 
										from resp inner join dict on dict.id=resp.id_w  
										inner join users_jsonb on users_jsonb.id=resp.id_u 
										where dict.test={$test} {$search}
										group by dict.word, rw 
										order by dict.word, cnt desc, rw;");
										
		if(!$result){disconnect($conn); return Array();}
		$str = "";
		$word = "";
		$num = -1;
		$cnt = Array(0,0,0,0);
		for($i=0; $i< pg_numrows($result); $i++){
			$arr = pg_fetch_array($result, $i);
			if($word == ""){
				$word = $arr[1];
				if($arr[0] != '-'){
					$str = $arr[0];
					$num = $arr[2];
					$cnt[0] = $arr[2];
					$cnt[1] = 1;
					$cnt[2] = ($arr[2] == 1)?1:0;
					$cnt[3] = 0;
				}else{
					$str = "";
					$cnt[0] = $arr[2]; $cnt[1] = 0; $cnt[2] = 0; $cnt[3] = $arr[2];
					$num = $arr[2];
				}
			}else{
				if($word == $arr[1]){
					if($arr[0] != '-'){
						if(($num != $arr[2]) && ($str !="")){
							$str .= " \\{$num}\\; ";
						}
						$str .= ", $arr[0]";
						$cnt[0] += $arr[2];
						$cnt[1] += 1;
						$cnt[2] += ($arr[2] == 1)?1:0;
						$num = $arr[2];
					}else{
						$cnt[0] += $arr[2];
						$cnt[3] += $arr[2];
//						$num = $arr[2];
					}
				}else{
					$str = preg_replace("/^, /", "", $str);
					$str = preg_replace("/; , /", "; ", $str);
					$str .= " \\{$num}\\";
					array_push($res, Array($word, "{$cnt[0]}", "{$str}<br>({$cnt[0]}, {$cnt[1]}, {$cnt[3]}, {$cnt[2]})"));
					$num = -1;
					$word = $arr[1];
					$str = "";
					if($arr[0] != '-'){
						if(($num != $arr[2]) && ($str !="")){
							$str .= " \\{$num}\\; ";
						}
						$str .= ", $arr[0]";
						$cnt[0] = $arr[2];
						$cnt[1] = 1;
						$cnt[2] = ($arr[2] == 1)?1:0;
						$cnt[3] = 0;
						$num = $arr[2];
					}else{
						$str = "";
						$cnt[0] = $arr[2]; $cnt[1] = 0; $cnt[2] = 0; $cnt[3] = $arr[2];
						$num = $arr[2];
					}
				}
			}
		}
		$str = preg_replace("/^, /", "", $str);
		$str = preg_replace("/; , /", "; ", $str);
		$str .= " \\{$num}\\";
		if($word != "") array_push($res, Array($word, "{$cnt[0]}", "{$str}<br>({$cnt[0]}, {$cnt[1]}, {$cnt[3]}, {$cnt[2]})"));
		if($sort_order==0) {
			usort($res, "rcmp");
		}else{
			usort($res, "ccmp");
		}
		return $res;
	}else{
		return Array();
	}
	return Array();
}
/*
to :
Request cookies :
dict:
	expires	"2021-07-16T20:08:34.000Z"
	path:"/"
	value:"right"
right_12_s_criteria	:
	path:"/"
	value:"/A/0/[]"

Response cookies : 
dict:"right"
pref_lang:"fr"
right_12_s_criteria:"/A/0/[]"
test:"12"

Response data :
{1}{affirmer}{dire \100\; confirmer, oui \43\; sûr \29\; déclarer \12\; assurer, certitude, infirmer, nier \11\; être sûr \10\; soutenir \9\; imposer \7\; acquiescer, certain, convaincre, croire, prétendre \6\; assurance, défendre, personnalité, sûreté \5\; contredire, oser, sûre, vérité, vrai \4\; annoncer, argumenter, assumer, attester, autoritaire, caractère, clamer, conviction, discours, position, savoir, sûr de soi, volonté \3\; appuyer, certifier, connaître, contraire, d'accord, débat, décision, démontrer, énoncer, être sûr de soi, force, jurer, ok, opinion, opposer, péremptoire, phrase, prouver, revendiquer, vouloir \2\; !, accepter, accorder, arrogance, assertion, assuré, avis, avocat, avouer, bêtise, bien, bousculer, choisir, choix, claironner, conclure, confiance, confiance en soi, contester, courage, crier, croyance, débattre, décider, demande, démonter, déposer avec assurance, destin, directeur, dire haut et fort, discours politique, douter, être, être mieux, fermement, fermeté, fort, hautain, hochement, idée, ignorer, insister, juste, la vérité, lumineux, mettre en avant, négative, obliger, obstiné, opiner, opter, ordre, parler, parole, pensée, persuader, point, ponctuation, poser, positif, prendre une décision, professeur, prononcer, proposition, raison, rassurer, répondre, réprouve, scientifique, s'engager, sentence, s'imposer, soi, solide, soumettre, taire, tenir tête, têtu, têtue, to affirm, ton, trait de caractère, une volonté, vindicatif \1\
(543, 143, 13, 84)}
{2}{appartement}{maison \203\; logement \43\; immeuble \34\; studio \30\; ville \16\; habitation \14\; petit \13\; loft, loyer \9\; chambre, colocation \7\; foyer, habitat, location \6\; balcon, cocon, étage, indépendance, louer, vie, villa, vivre \5\; étudiant, flat, liberté \4\; appart, autonomie, building, cher, chez soi, dormir, pièces, urbain \2\; 9, apparemment, assumer, ben dhaou, calme, cambriolage, chercher, cherté, clé, coffre, collocation, coloc, confort, construction du soi, couloir, cuisine, domicile, ensoleillé, escaliers, étroitesse, fenêtre, fenêtres, fermer, grand, grotte, habiter, immobilier, inondation, jeunes, liberté !, lieu, lieu de vie, lieux, lit, locataire, loger, logis, lumineux, manger, Miami, mignon, nécessaire, neuf, numéro deux, oui, Paris, parisien, personnel, petite maison, pièce, plantes, porte, posséder, propriété, repos, résidence, room, rue, salle, salon, sol, sonner, surface, toit, transitoire, vide, vue \1\
(543, 100, 5, 67)}
{3}{attention}{danger \213\; panneau, prudence \22\; concentration \19\; stop \10\; vigilance \9\; écoute, intérêt \8\; alerte, gaffe, marche, précaution \6\; garde \5\; attentif, gare, méfiance, peur, regard, soin \4\; accident, à la marche, attention, avertissement, faire, feu, observation, risque, triangle, voiture \3\; achtung, aimer, be careful, chien, chut, conscience, dangereux, éveil, mémoire, oeil, piège, porter, prendre soin, prudent, regarder, rouge \2\; !, !!!!!!!!!!!, aïe, aiguë, alerter, ami, appliqué, attente, attirer, besoin, bienveillance, cadeau, carefull, caution, céder le passage, cerveau, chaussée glissante, chiens méchants, cognition, concentré, cri, délicat, délicatesse, demander, derrière, détail, distraction, donner, écouter, effort, égard, enfant, entendre, erreur, examen, express, extrémité, faire plaisir, faute, fragile, gentillesse, gravité, halte, hear, important, inattention, indifférence, interdire, j'arrive, la marche, lucidité, méchant, méditer, mégarde, mobilisation, nécessaire, négligence, non, nonchalance, oh!, oups, paneau, partager, pensée, péril, persévérance, point d'exclamation, portée, précision, préjugé, prendre garde, préparation, présent, prévenant, prévoyant, question, radar, risques, route, sauvegarde, se méfier, sensibilité, signal, silence, s'il vous plaît, soutenue, surprise, surveillance, surveiller, susciter, sympathie, test, travaux, un roux !, vif, vigilant, vu, vue, warning, whore, yeux \1\
(541, 146, 14, 101)}
{4}{apercevoir}{voir \230\; entrevoir \51\; regarder \26\; distinguer \17\; loin \16\; vue \13\; yeux \12\; lointain \8\; observer \7\; jumelles, quelqu'un \5\; comprendre, imaginer, oeil, vision, vu \4\; deviner, furtif, horizon, remarquer, sentir \3\; au loin, cligner, croiser, discerner, doute, éphémère, espion, espionner, flou, là-bas, lumière, lunette, oiseau, rapide, rapidité, réaliser, rendre compte, visualiser \2\; accueillir, analyser, aperçu, apparaître, attention, autoroute, brouillé, cacher, capter, chose, conscience, constater, coup d'oeil, croire, curieux, découvrir, détails, distance, éloigné, éloignement, embrasser, émerveiller, entendre, entr'apercevoir, entrebâillement, épier, erreur, essentiel, faucon, fenêtre, fluo, forme, fugace, fugacité, hasard, illusion, intercepter, juger, jumelle, le ciel, l'horizon, lorgner, lueur, macrophage, mater, monde, montagne, montrer, myope, ne prend qu'un p, nuage, percevoir, plisser, pressentir, reconnaître, regard, ressentir, scruter, secret, sembler, serrure, silhouette, surveiller, télévision, terre, visage, visionner, voire, voir, petit, voir, regarder, vouloir \1\
(540, 110, 8, 71)}
{5}{attendre}{patienter \132\; patience \49\; espérer \39\; bus \37\; temps \17\; long, montre, rester \13\; longtemps \12\; gare, retard, train \10\; impatience \9\; heure, quelqu'un \6\; poireauter \5\; ennui, patient, pénible, s'ennuyer, stopper \4\; arrêt de bus, Godot, horloge, partir, passer, s'impatienter, wait \3\; détester, ennuie, espère, heures, le bus, patiemment, patiente, profiter, queue, rendez-vous, salle, stop, voir \2\; absence, aéroport, agacer, aller, arrêter, arrivée, arriver, attendre, avancer, avec patience, beaucoup, bébé, but, caisse, calme, chiant, croire, déluge, demain, demeurer, dentiste, dépendre, désagréable, détendre, docteur, dormir, douter, écouter, encore, énervant, énervement, ennuyeux, en vain, espoir, être, exaspérant, expecter, file, fin, foncer, fumer, futur, impatiemment, impatient, jamais, là, laisser, lapin, lent, le train, longueur, médecin, métro, minute, minutes, moment, ne pas attendre, obtenir, paître, passif, peur, poiroter, prétendre, provoquer, râler, réponse, reposer, rêver, rien, salle d'attente, se languir, silence, sommet, songer, son tour, tendrement, toujours, to wait, ultérieur, vanité, veille, vite \1\
(537, 123, 7, 82)}
{6}{aimer}{adorer \68\; amour \66\; détester, haïr \34\; coeur \27\; chérir \18\; sentiment \16\; apprécier, donner \11\; bonheur, femme, souffrir \9\; passion, vivre \8\; désirer, embrasser \6\; mourir, partager, pleurer, tendresse \5\; famille \4\; ami, amoureux, confiance, fille, joie, love, passionnément, quelqu'un, sexe, toujours, vie \3\; admirer, agréable, amis, autre, beau, couple, dur, enfant, éternité, homme, maman, oui, partage, plaire, raison, vouloir \2\; 2, accepter, aduler, affection, aimer, Alice, amant, animaux, autrui, beaucoup, bien, bien-être, bisous, bleu, boire, bonne question, brûler, café, caresser, Caroline, c'est bon, chanter, chéri, choyer, cœur, comprendre, crever, décevoir, découvrir, désintéressé, désinvolture, désir, détruire, deux, dieu, douceur, douleur, échange, enchanter, encore, enfants, ensemble, entourer, être amoureux, faute, fiancée, fiancer, fidèle, folie, fort, fumisterie, génial, grand, important, indifférence, infini, jalouser, Laurence, l'autre, la vie, lien, longtemps, ma femme, magie, mariage, Martin, mentir, mère, mordre, Nathalie, none, paradoxe, partenaire, passionner, perdre, personne, peur, piège, pipeau, plaisir, préférer, prendre dans ses bras, protéger, réconfort, rendre, ressentir, rêver, Roméo, s'abandonner, saveur, se dévouer, sensation, sentiments, Simon, tendre, toi, tomber, tout, trésor, universel, valériane, Yassine \1\
(537, 150, 6, 102)}
*/ 
?>